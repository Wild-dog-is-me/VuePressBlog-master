{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{288:function(t,s,a){\"use strict\";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"nacos配置中心\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nacos配置中心\"}},[t._v(\"#\")]),t._v(\" Nacos配置中心\")]),t._v(\" \"),s(\"p\",[t._v(\"Nacos除了可以做注册中心，同样可以做配置管理来使用。\")]),t._v(\" \"),s(\"p\",[t._v(\"当微服务部署的实例越来越多，达到数十、数百时，逐个修改微服务配置就会让人抓狂，而且很容易出错。\"),s(\"strong\",[t._v(\"我们需要一种统一配置管理方案，可以集中管理所有实例的配置。\")])]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092150.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf17f54cd3f937bfcaec.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"Nacos 一方面可以将配置集中管理，另一方可以在配置变更时，及时通知微服务，\"),s(\"strong\",[t._v(\"实现配置的热更新。\")])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"创建配置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#创建配置\"}},[t._v(\"#\")]),t._v(\" 创建配置\")]),t._v(\" \"),s(\"p\",[t._v(\"在 Nacos 控制面板中添加配置文件\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092159.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf17f54cd3f937bfcb42.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"然后在弹出的表单中，填写配置信息：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092206.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf17f54cd3f937bfcbb2.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"注意\")]),t._v(\"：项目的核心配置，需要热更新的配置才有放到 nacos 管理的必要。基本不会变更的一些配置(例如数据库连接)还是保存在微服务本地比较好。\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"拉取配置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#拉取配置\"}},[t._v(\"#\")]),t._v(\" 拉取配置\")]),t._v(\" \"),s(\"p\",[t._v(\"首先我们需要了解 Nacos 读取配置文件的环节是在哪一步，在没加入 Nacos 配置之前，获取配置是这样：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092215.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf17f54cd3f937bfcc84.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"加入 Nacos 配置，它的读取是在 application.yml 之前的：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092223.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfcce9.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"这时候如果把 nacos 地址放在 application.yml 中，显然是不合适的，\"),s(\"strong\",[t._v(\"Nacos 就无法根据地址去获取配置了。\")])]),t._v(\" \"),s(\"p\",[t._v(\"因此，nacos 地址必须放在优先级最高的 bootstrap.yml 文件。\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092228.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfcd9a.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"引入 nacos-config 依赖\")])]),t._v(\" \"),s(\"p\",[t._v(\"首先，在 user-service 服务中，引入 nacos-config 的客户端依赖：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-xml line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-xml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"\\x3c!--nacos配置管理依赖--\\x3e\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"dependency\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"groupId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"com.alibaba.cloud\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"groupId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"artifactId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"spring-cloud-starter-alibaba-nacos-config\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"artifactId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token tag\"}},[s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"</\")]),t._v(\"dependency\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\")])]),s(\"p\",[s(\"strong\",[t._v(\"添加 bootstrap.yml\")])]),t._v(\" \"),s(\"p\",[t._v(\"然后，在 user-service 中添加一个 bootstrap.yml 文件，内容如下：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"application\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" userservice \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 服务名称\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"profiles\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"active\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" dev \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#开发环境，这里是dev \")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"cloud\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nacos\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"server-addr\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" localhost\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"8848\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# Nacos地址\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"config\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"file-extension\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" yaml \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 文件后缀名\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"9\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"10\")]),s(\"br\")])]),s(\"p\",[t._v(\"根据 spring.cloud.nacos.server-addr 获取 nacos地址，再根据\"),s(\"code\",[t._v(\"${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}\")]),t._v(\"作为文件id，来读取配置。\")]),t._v(\" \"),s(\"p\",[t._v(\"在这个例子例中，就是去读取 \"),s(\"code\",[t._v(\"userservice-dev.yaml\")])]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092237.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfcdb7.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"使用代码来验证是否拉取成功\")]),t._v(\" \"),s(\"p\",[t._v(\"在 user-service 中的 UserController 中添加业务逻辑，读取 pattern.dateformat 配置并使用：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Value\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"${pattern.dateformat}\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" dateformat\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"now\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"now\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"//格式化时间\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"LocalDateTime\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"now\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"format\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"DateTimeFormatter\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"ofPattern\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"dateformat\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),s(\"br\")])]),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfe01cf54cd3f937c6d33f.png\",alt:\"image-20220726203747854\"}})]),t._v(\" \"),s(\"h2\",{attrs:{id:\"配置热更新\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置热更新\"}},[t._v(\"#\")]),t._v(\" 配置热更新\")]),t._v(\" \"),s(\"p\",[t._v(\"我们最终的目的，是修改 nacos 中的配置后，微服务中无需重启即可让配置生效，也就是\"),s(\"strong\",[t._v(\"配置热更新\")]),t._v(\"。\")]),t._v(\" \"),s(\"p\",[t._v(\"有两种方式：1. 用 \"),s(\"code\",[t._v(\"@value\")]),t._v(\" 读取配置时，搭配 \"),s(\"code\",[t._v(\"@RefreshScope\")]),t._v(\"；2. 直接用 \"),s(\"code\",[t._v(\"@ConfigurationProperties\")]),t._v(\" 读取配置\")]),t._v(\" \"),s(\"h3\",{attrs:{id:\"refreshscope\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#refreshscope\"}},[t._v(\"#\")]),t._v(\" @RefreshScope\")]),t._v(\" \"),s(\"p\",[t._v(\"方式一：在 \"),s(\"code\",[t._v(\"@Value\")]),t._v(\" 注入的变量所在类上添加注解 \"),s(\"code\",[t._v(\"@RefreshScope\")])]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfe056f54cd3f937c85498.png\",alt:\"image-20220726203845685\"}})]),t._v(\" \"),s(\"h3\",{attrs:{id:\"configurationproperties\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#configurationproperties\"}},[t._v(\"#\")]),t._v(\" @ConfigurationProperties\")]),t._v(\" \"),s(\"p\",[t._v(\"方式二：使用 \"),s(\"code\",[t._v(\"@ConfigurationProperties\")]),t._v(\" 注解读取配置文件，就不需要加 \"),s(\"code\",[t._v(\"@RefreshScope\")]),t._v(\" 注解。\")]),t._v(\" \"),s(\"p\",[t._v(\"在 user-service 服务中，添加一个 PatternProperties 类，读取 \"),s(\"code\",[t._v(\"patterrn.dateformat\")]),t._v(\" 属性\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Data\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Component\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@ConfigurationProperties\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"prefix \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"pattern\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"PatternProperties\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" dateformat\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Autowired\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"PatternProperties\")]),t._v(\" patternProperties\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token annotation punctuation\"}},[t._v(\"@GetMapping\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"now2\"')]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"String\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"now2\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"//格式化时间\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"LocalDateTime\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"now\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"format\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"DateTimeFormatter\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"ofPattern\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"patternProperties\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"dateformat\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"9\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"10\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"11\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"12\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"13\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"14\")]),s(\"br\")])]),s(\"h2\",{attrs:{id:\"配置共享\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置共享\"}},[t._v(\"#\")]),t._v(\" 配置共享\")]),t._v(\" \"),s(\"p\",[t._v(\"其实在服务启动时，nacos 会读取多个配置文件，例如：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[t._v(\"[spring.application.name]-[spring.profiles.active].yaml\")]),t._v(\"，例如：userservice-dev.yaml\")]),t._v(\" \"),s(\"li\",[s(\"code\",[t._v(\"[spring.application.name].yaml\")]),t._v(\"，例如：userservice.yaml\")])]),t._v(\" \"),s(\"p\",[t._v(\"这里的 \"),s(\"code\",[t._v(\"[spring.application.name].yaml\")]),t._v(\" 不包含环境，\"),s(\"strong\",[t._v(\"因此可以被多个环境共享\")]),t._v(\"。\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"添加一个环境共享配置\")])]),t._v(\" \"),s(\"p\",[t._v(\"我们在 nacos 中添加一个 userservice.yaml 文件：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092323.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfcf36.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"在 user-service 中读取共享配置\")])]),t._v(\" \"),s(\"p\",[t._v(\"在 user-service 服务中，修改 PatternProperties 类，读取新添加的属性：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfea4df54cd3f9370b90da.png\",alt:\"image-20220726212116762\"}})]),t._v(\" \"),s(\"p\",[t._v(\"在 user-service 服务中，修改 UserController，添加一个方法：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfea67f54cd3f9370c5235.png\",alt:\"image-20220726212143180\"}})]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"运行两个 UserApplication，使用不同的profile\")])]),t._v(\" \"),s(\"p\",[t._v(\"修改 UserApplication2 这个启动项，改变其profile值：\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfea8bf54cd3f9370d50b1.png\",alt:\"image-20220726212219213\"}})]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfeab0f54cd3f9370e57df.png\",alt:\"image-20220726212256040\"}})]),t._v(\" \"),s(\"p\",[t._v(\"这样，UserApplication(8081) 使用的 profile 是 dev，UserApplication2(8082) 使用的 profile 是test\")]),t._v(\" \"),s(\"p\",[t._v(\"启动 UserApplication 和 UserApplication2\")]),t._v(\" \"),s(\"p\",[t._v(\"访问地址：http://localhost:8081/user/prop，结果：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092400.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfd2f0.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"访问地址：http://localhost:8082/user/prop，结果：\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092419.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfd2ed.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"可以看出来，不管是 dev，还是 test 环境，都读取到了 envSharedValue 这个属性的值。\")]),t._v(\" \"),s(\"p\",[t._v(\"上面的都是同一个微服务下，\"),s(\"strong\",[t._v(\"那么不同微服务之间可以环境共享吗？\")])]),t._v(\" \"),s(\"p\",[t._v(\"通过下面的两种方式来指定：\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[t._v(\"extension-configs\")]),t._v(\" \"),s(\"li\",[t._v(\"shared-configs\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-yml line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"cloud\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nacos\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"config\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"file-extension\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" yaml \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 文件后缀名\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"extends-configs\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 多微服务间共享的配置列表\")]),t._v(\"\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"dataId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" common.yaml \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 要共享的配置文件id\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"cloud\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nacos\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"config\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"file-extension\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" yaml \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 文件后缀名\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"shared-configs\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 多微服务间共享的配置列表\")]),t._v(\"\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"dataId\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" common.yaml \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# 要共享的配置文件id\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"9\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"10\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"11\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"12\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"13\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"14\")]),s(\"br\")])]),s(\"h2\",{attrs:{id:\"配置优先级\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置优先级\"}},[t._v(\"#\")]),t._v(\" 配置优先级\")]),t._v(\" \"),s(\"p\",[t._v(\"当 nacos、服务本地同时\"),s(\"strong\",[t._v(\"出现相同属性时\")]),t._v(\"，优先级有高低之分。\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092501.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf18f54cd3f937bfd393.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"更细致的配置\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/20210901092520.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf19f54cd3f937bfd549.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"h1\",{attrs:{id:\"nacos集群\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nacos集群\"}},[t._v(\"#\")]),t._v(\" Nacos集群\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"架构介绍\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#架构介绍\"}},[t._v(\"#\")]),t._v(\" 架构介绍\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/202108181959897.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf19f54cd3f937bfd59c.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"其中包含 3 个Nacos 节点，然后一个负载均衡器 Nginx 代理 3 个 Nacos，我们计划的 Nacos 集群如下图，MySQL 的主从复制后续再添加。\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/202108182000220.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf19f54cd3f937bfd6c3.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"三个 Nacos 节点的地址\")]),t._v(\" \"),s(\"table\",[s(\"thead\",[s(\"tr\",[s(\"th\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"节点\")]),t._v(\" \"),s(\"th\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"ip\")]),t._v(\" \"),s(\"th\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"port\")])])]),t._v(\" \"),s(\"tbody\",[s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"nacos1\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"192.168.150.1\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"8845\")])]),t._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"nacos2\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"192.168.150.1\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"8846\")])]),t._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"nacos3\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"192.168.150.1\")]),t._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[t._v(\"8847\")])])])]),t._v(\" \"),s(\"h2\",{attrs:{id:\"初始化数据库\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#初始化数据库\"}},[t._v(\"#\")]),t._v(\" 初始化数据库\")]),t._v(\" \"),s(\"p\",[t._v(\"Nacos 默认数据存储在内嵌数据库 Derby 中，不属于生产可用的数据库。官方推荐的最佳实践是使用带有主从的高可用数据库集群，主从模式的高可用数据库。这里我们以单点的数据库为例。\")]),t._v(\" \"),s(\"p\",[t._v(\"首先新建一个数据库，命名为 nacos，而后导入下面的 SQL\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"配置nacos\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置nacos\"}},[t._v(\"#\")]),t._v(\" 配置Nacos\")]),t._v(\" \"),s(\"p\",[t._v(\"进入 nacos 的 conf 目录，修改配置文件 cluster.conf.example，重命名为 cluster.conf\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/202108182004564.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf19f54cd3f937bfd6c0.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"添加内容\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"127.0.0.1:8845\\n127.0.0.1.8846\\n127.0.0.1.8847\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\")])]),s(\"p\",[t._v(\"然后修改 application.properties 文件，添加数据库配置\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"spring.datasource.platform\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"mysql\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"db.num\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"1\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"db.url.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"db.user.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"root\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"db.password.0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"123456\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\")])]),s(\"p\",[t._v(\"将 nacos 文件夹复制三份，分别命名为：nacos1、nacos2、nacos3\")]),t._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"https://cdn.xn2001.com/img/2021/202108182004103.png\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://pic.imgdb.cn/item/62dfdf19f54cd3f937bfd7bd.png\",alt:\"img\"}}),s(\"OutboundLink\")],1)]),t._v(\" \"),s(\"p\",[t._v(\"然后分别修改三个文件夹中的 application.properties，\")]),t._v(\" \"),s(\"p\",[t._v(\"nacos1\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"server.port\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"8845\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\")])]),s(\"p\",[t._v(\"nacos2\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"server.port\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"8846\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\")])]),s(\"p\",[t._v(\"nacos3\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-properties line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-properties\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key attr-name\"}},[t._v(\"server.port\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token value attr-value\"}},[t._v(\"8847\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\")])]),s(\"p\",[t._v(\"然后分别启动三个 nacos\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"startup.cmd\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\")])]),s(\"h2\",{attrs:{id:\"nginx反向代理\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nginx反向代理\"}},[t._v(\"#\")]),t._v(\" Nginx反向代理\")]),t._v(\" \"),s(\"p\",[t._v(\"修改 nginx 文件夹下的 conf/nginx.conf 文件，配置如下\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-nginx line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-nginx\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"upstream\")]),t._v(\" nacos-cluster\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"server\")]),t._v(\" 127.0.0.1:8845\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"server\")]),t._v(\" 127.0.0.1:8846\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"server\")]),t._v(\" 127.0.0.1:8847\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"server\")])]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"listen\")]),t._v(\"       \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"80\")])]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"server_name\")]),t._v(\"  localhost\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"location\")]),t._v(\" /nacos\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token directive\"}},[s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"proxy_pass\")]),t._v(\" http://nacos-cluster\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"5\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"6\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"7\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"8\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"9\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"10\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"11\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"12\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"13\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"14\")]),s(\"br\")])]),s(\"p\",[t._v(\"启动 nginx，在浏览器访问：http://localhost/nacos\")]),t._v(\" \"),s(\"p\",[t._v(\"在代码中的 application.yml 文件配置改为如下：\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-yaml line-numbers-mode\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spring\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"cloud\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nacos\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"server-addr\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" localhost\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"80\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# Nacos地址\")]),t._v(\"\\n\")])]),t._v(\" \"),s(\"div\",{staticClass:\"line-numbers-wrapper\"},[s(\"span\",{staticClass:\"line-number\"},[t._v(\"1\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"2\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"3\")]),s(\"br\"),s(\"span\",{staticClass:\"line-number\"},[t._v(\"4\")]),s(\"br\")])]),s(\"p\",[t._v(\"实际部署时，需要给做反向代理的 Nginx 服务器设置一个域名，这样后续如果有服务器迁移 Nacos 的客户端也无需更改配置。Nacos 的各个节点应该部署到多个不同服务器，做好容灾和隔离工作。\")])])}),[],!1,null,null,null);s.default=e.exports}}]);","extractedComments":[]}